# Context-Aware Agents System

## üéØ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≥–µ–Ω—Ç–æ–≤ –±—ã–ª–∞ —É–ª—É—á—à–µ–Ω–∞ –¥–ª—è **–ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞**. –¢–µ–ø–µ—Ä—å –≤—Å–µ –∞–≥–µ–Ω—Ç—ã –ø–æ–Ω–∏–º–∞—é—Ç –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, –ø–æ–º–Ω—è—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏—è –∏ –æ—Ç–∑—ã–≤—ã.

## üß† –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤**
- ‚úÖ **Search Agent** - –ø–æ–º–Ω–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∏—Å–∫–∏ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
- ‚úÖ **Outfit Agent** - —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∏–ª—å –∏ –æ—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- ‚úÖ **General Agent** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- ‚úÖ **Coordinator Agent** - –ø–æ–Ω–∏–º–∞–µ—Ç –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

### 2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã**
- üéØ **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- üéØ **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- üéØ **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã –∞–≥–µ–Ω—Ç–∞–º

### 3. **–û–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö**
- üìö **Search**: –±—é–¥–∂–µ—Ç, –±—Ä–µ–Ω–¥—ã, —Å—Ç–∏–ª—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- üìö **Outfit**: —Ü–≤–µ—Ç–∞, —Å—Ç–∏–ª–∏, –∫–æ–º—Ñ–æ—Ä—Ç, —Å–ª—É—á–∞–∏
- üìö **General**: –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ —Ç–µ–º—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

### Coordinator Agent - –ú–æ–∑–≥ —Å–∏—Å—Ç–µ–º—ã

```python
def create_contextual_prompt(user_message: str, chat_history: MessageHistory, agent_type: str) -> str:
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 —Å–æ–æ–±—â–µ–Ω–∏–π
    # –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–∏–ø—É –∞–≥–µ–Ω—Ç–∞
    # –°–æ–∑–¥–∞–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
```

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:**
```
Based on our conversation context:
Previous: –ù–∞–π–¥–∏ –º–Ω–µ —á–µ—Ä–Ω—É—é —Ñ—É—Ç–±–æ–ª–∫—É –¥–æ $30
Previous: –ß—Ç–æ-—Ç–æ –ø–æ–¥–µ—à–µ–≤–ª–µ –∏ –¥—Ä—É–≥–æ–≥–æ –±—Ä–µ–Ω–¥–∞

Current request: –ü–æ–∫–∞–∂–∏ –µ—â–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

Please consider the conversation history when providing your response...
```

### Search Agent - –£–º–Ω—ã–π –ø–æ–∏—Å–∫

**–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üîç **–ü–æ–º–Ω–∏—Ç –±—é–¥–∂–µ—Ç** - "—á—Ç–æ-—Ç–æ –¥–µ—à–µ–≤–ª–µ" ‚Üí –∏—â–µ—Ç –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- üîç **–£—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ç–∑—ã–≤—ã** - "–¥—Ä—É–≥–æ–π –±—Ä–µ–Ω–¥" ‚Üí –∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –±—Ä–µ–Ω–¥—ã  
- üîç **–ü–æ–Ω–∏–º–∞–µ—Ç —Å—Ç–∏–ª—å** - "–±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ" ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –ø–æ–∏—Å–∫
- üîç **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è** - –ø–æ–º–Ω–∏—Ç –ª—é–±–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ª–æ–≥–æ–≤:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–∞–π–¥–∏ —á–µ—Ä–Ω—É—é —Ñ—É—Ç–±–æ–ª–∫—É
–ê–≥–µ–Ω—Ç: [–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ß—Ç–æ-—Ç–æ –ø–æ–¥–µ—à–µ–≤–ª–µ 
–ê–≥–µ–Ω—Ç: [–∏—â–µ—Ç –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –ø–æ–º–Ω—è –æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø–æ–∏—Å–∫–µ]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ò –¥—Ä—É–≥–æ–≥–æ –±—Ä–µ–Ω–¥–∞
–ê–≥–µ–Ω—Ç: [–∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –±—Ä–µ–Ω–¥—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ü–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω]
```

### Outfit Agent - –õ–∏—á–Ω—ã–π —Å—Ç–∏–ª–∏—Å—Ç

**–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üëó **–ò–∑—É—á–∞–µ—Ç —Å—Ç–∏–ª—å** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üëó **–ü–æ–º–Ω–∏—Ç –æ—Ç–∑—ã–≤—ã** - "—Å–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω–æ" ‚Üí –±–æ–ª–µ–µ casual –≤–∞—Ä–∏–∞–Ω—Ç—ã
- üëó **–£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–º—Ñ–æ—Ä—Ç** - "–Ω–µ—É–¥–æ–±–Ω–æ" ‚Üí –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ–º—Ñ–æ—Ä—Ç—É
- üëó **–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Å–ª—É—á–∞—è–º** - –ø–æ–º–Ω–∏—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**–ü—Ä–∏–º–µ—Ä—ã –¥–∏–∞–ª–æ–≥–æ–≤:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ß—Ç–æ –Ω–∞–¥–µ—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É?
–ê–≥–µ–Ω—Ç: [–ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç business-casual –Ω–∞—Ä—è–¥]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –Ω–∞—à–µ–≥–æ –æ—Ñ–∏—Å–∞
–ê–≥–µ–Ω—Ç: [–ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–æ–ª–µ–µ casual, –Ω–æ –≤—Å–µ –µ—â–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ê —á—Ç–æ –Ω–∞—Å—á–µ—Ç —Ü–≤–µ—Ç–∞? –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Å–∏–Ω–∏–π
–ê–≥–µ–Ω—Ç: [–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–∏–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã]
```

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. Coordinator Agent
```python
async def coordinate_request(message: str, user_id: int, db: Session, chat_id: int):
    # 1. –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
    history = await get_chat_history(db, chat_id)
    
    # 2. –ü–µ—Ä–µ–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–≥–µ–Ω—Ç—É-–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É
    result = await coordinator_agent.run(
        message,
        deps=deps,
        message_history=history.to_pydantic_ai_messages()
    )
```

### 2. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã
```python
async def search_products(ctx: RunContext[CoordinatorDependencies], user_message: str):
    # 1. –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
    history = await get_chat_history(ctx.deps.db, ctx.deps.chat_id)
    
    # 2. –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    contextual_prompt = create_contextual_prompt(user_message, history, "search")
    
    # 3. –ó–∞–ø—É—Å–∫–∞–µ—Ç –∞–≥–µ–Ω—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    result = await search_agent.run(
        contextual_prompt,
        message_history=history.to_pydantic_ai_messages()
    )
```

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —É—Ç–æ—á–Ω–µ–Ω–∏—è–º–∏
```
1. "–ù–∞–π–¥–∏ –º–Ω–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ Nike"
   ‚Üí –ê–≥–µ–Ω—Ç –∏—â–µ—Ç –∫—Ä–æ—Å—Å–æ–≤–∫–∏ Nike

2. "–ß—Ç–æ-—Ç–æ –ø–æ–¥–µ—à–µ–≤–ª–µ"  
   ‚Üí –ê–≥–µ–Ω—Ç –ø–æ–º–Ω–∏—Ç –ø—Ä–æ Nike, –∏—â–µ—Ç –±–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

3. "–ú–æ–∂–µ—Ç –¥—Ä—É–≥–æ–π –±—Ä–µ–Ω–¥?"
   ‚Üí –ê–≥–µ–Ω—Ç –∏—â–µ—Ç –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –¥—Ä—É–≥–∏—Ö –±—Ä–µ–Ω–¥–æ–≤ –≤ —Ç–æ–º –∂–µ —Ü–µ–Ω–æ–≤–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ

4. "–î–ª—è –±–µ–≥–∞"
   ‚Üí –ê–≥–µ–Ω—Ç —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –±–µ–≥–æ–≤—ã—Ö –∫—Ä–æ—Å—Å–æ–≤–∫–∞—Ö —Å —É—á–µ—Ç–æ–º –±—é–¥–∂–µ—Ç–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–¥–±–æ—Ä –Ω–∞—Ä—è–¥–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞–º–∏
```
1. "–ß—Ç–æ –Ω–∞–¥–µ—Ç—å –Ω–∞ —Å–≤–∏–¥–∞–Ω–∏–µ?"
   ‚Üí –ê–≥–µ–Ω—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π –Ω–∞—Ä—è–¥

2. "–°–ª–∏—à–∫–æ–º –Ω–∞—Ä—è–¥–Ω–æ, —á—Ç–æ-—Ç–æ –ø–æ–ø—Ä–æ—â–µ"
   ‚Üí –ê–≥–µ–Ω—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç casual-chic –≤–∞—Ä–∏–∞–Ω—Ç

3. "–ú–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —ç—Ç–æ—Ç —Ü–≤–µ—Ç"
   ‚Üí –ê–≥–µ–Ω—Ç –º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç–æ–≤—É—é –≥–∞–º–º—É, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç–∏–ª—å

4. "–ê –µ—Å–ª–∏ –ø–æ–≥–æ–¥–∞ –ø—Ä–æ—Ö–ª–∞–¥–Ω–∞—è?"
   ‚Üí –ê–≥–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Ö–Ω—é—é –æ–¥–µ–∂–¥—É, –ø–æ–º–Ω—è —Å—Ç–∏–ª—å –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ—à–∞–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥
```
1. "–ù–∞–π–¥–∏ —á–µ—Ä–Ω–æ–µ –ø–ª–∞—Ç—å–µ" (Search Agent)
   ‚Üí –ü–æ–∏—Å–∫ —á–µ—Ä–Ω—ã—Ö –ø–ª–∞—Ç—å–µ–≤

2. "–ö–∞–∫ –µ–≥–æ –ª—É—á—à–µ —Å–æ—á–µ—Ç–∞—Ç—å?" (Outfit Agent)  
   ‚Üí –ê–≥–µ–Ω—Ç –ø–æ–º–Ω–∏—Ç –ø—Ä–æ —á–µ—Ä–Ω–æ–µ –ø–ª–∞—Ç—å–µ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã

3. "–ê –∫–∞–∫–∞—è –æ–±—É–≤—å –ø–æ–¥–æ–π–¥–µ—Ç?" (Outfit Agent)
   ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ç–µ–º –∂–µ –ø–ª–∞—Ç—å–µ–º

4. "–ü–æ–∫–∞–∂–∏ –ø–æ—Ö–æ–∂–∏–µ –ø–ª–∞—Ç—å—è –¥—Ä—É–≥–∏—Ö —Ü–≤–µ—Ç–æ–≤" (Search Agent)
   ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–æ–∏—Å–∫—É, –ø–æ–º–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–ª–∞—Ç—å—è
```

## üöÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Message History Format
```python
class MessageHistory(BaseModel):
    messages: List[dict] = Field(default_factory=list)
    
    def to_pydantic_ai_messages(self) -> List[ModelMessage]:
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç PydanticAI
```

### Contextual Prompt Creation
```python
def create_contextual_prompt(user_message: str, chat_history: MessageHistory, agent_type: str) -> str:
    # –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 6 —Å–æ–æ–±—â–µ–Ω–∏–π
    recent_messages = chat_history.messages[-6:]
    
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    if agent_type == "search":
        # –ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —Ü–µ–Ω, –±—Ä–µ–Ω–¥–æ–≤
    elif agent_type == "outfit":  
        # –ü–æ–∏—Å–∫ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ–¥–µ–∂–¥—ã, —Å—Ç–∏–ª—è, —Å–ª—É—á–∞–µ–≤
        
    # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
    return enhanced_prompt
```

### Enhanced System Prompts
–ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
```
CONVERSATION CONTEXT AWARENESS:
- Access to conversation history
- Learning from user feedback  
- Preference tracking over time
- Contextual refinement capabilities

CONTEXTUAL EXAMPLES:
- "something cheaper" ‚Üí focus on lower prices
- "different style" ‚Üí adjust style parameters
- "more comfortable" ‚Üí prioritize comfort
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–ª—É—á—à–µ–Ω–∏–π

### –î–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚ùå –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚ùå –ê–≥–µ–Ω—Ç—ã –Ω–µ –ø–æ–º–Ω–∏–ª–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è  
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Ç–æ—á–Ω–µ–Ω–∏–π

### –ü–æ—Å–ª–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤  
- ‚úÖ **–ü–æ–ª–Ω–∞—è –ø–∞–º—è—Ç—å** —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- ‚úÖ **–ò–∑—É—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–£–º–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è** –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- ‚úÖ **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥** –∫–∞–∫ —Å —á–µ–ª–æ–≤–µ–∫–æ–º

## üéâ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥** - –∫–∞–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å —á–µ–ª–æ–≤–µ–∫–æ–º-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º
2. **–ü–∞–º—è—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π** - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è  
3. **–£–º–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è** - "—á—Ç–æ-—Ç–æ –ø–æ–¥–µ—à–µ–≤–ª–µ" –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
4. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —É–ª—É—á—à–∞—é—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
5. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π, –±–æ–ª—å—à–µ —Ç–æ—á–Ω–æ—Å—Ç–∏

## üõ†Ô∏è –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
```python
# 1. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É message_history –≤ –∞–≥–µ–Ω—Ç
async def my_agent_function(query: str, message_history: List[ModelMessage] = None):
    agent = get_my_agent()
    result = await agent.run(query, message_history=message_history)
    return result.data

# 2. –û–±–Ω–æ–≤–∏—Ç–µ system prompt —Å CONVERSATION CONTEXT AWARENESS
system_prompt = """
CONVERSATION CONTEXT AWARENESS:
- Analyze conversation history for relevant context
- Learn user preferences from previous interactions
- Handle follow-up questions and refinements
"""

# 3. –î–æ–±–∞–≤—å—Ç–µ –≤ coordinator_agent.py
async def my_tool(ctx: RunContext[CoordinatorDependencies], user_message: str):
    history = await get_chat_history(ctx.deps.db, ctx.deps.chat_id)
    contextual_prompt = create_contextual_prompt(user_message, history, "my_type")
    return await my_agent_function(contextual_prompt, history.to_pydantic_ai_messages())
```

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–∞** –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏ –Ω—é–∞–Ω—Å–æ–≤! üéØ 